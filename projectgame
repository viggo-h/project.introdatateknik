
import pygame
import sys
pygame.init()

# Skapa fönstret
screen = pygame.display.set_mode((800, 600))
pygame.display.set_caption("Pygame")

# Bakgrundsbild
background_image = pygame.image.load("background.png")
background_image = pygame.transform.scale(background_image, (800, 600))  

#Bilder för hinder
brick_wall = pygame.image.load("brick_wall.jpg")
brick_wall = pygame.transform.scale(brick_wall, (100, 20))

# Färger 
black = (0, 0, 0)
white = (255, 255, 255)
red = (255, 0, 0)
silver =(192, 192, 192)

# Huvudkaraktär position 
circle_x, circle_y = 40, 300
circle_radius = 40
circle_speed_x = 10
circle_speed_y = 0
jump_strength = -15
on_ground = False
doublejump = False  

#Liv och skada
hearts = 3
tagen_skada = False

# Fiende 
fiende_x, fiende_y = 400, 530
fiende_storlek = 80
fiende_speed_x = 5

#Spik 1
spik_x, spik_y = 400, 160
spik_x_storlek = 20


gravity = 0.5  # Gravitation
level = 1  # Level

# Text
font = pygame.font.Font(None, 74)
small_font = pygame.font.Font(None, 36)

startmenu = True
gameover = False

def show_start_menu(): #startskärm
    screen.fill(black)
    title_text = font.render("Welcome to the Game!", True, white)
    start_text = small_font.render("Press enter to begin", True, white)
    screen.blit(title_text, (800 // 2 - title_text.get_width() // 2, 200))
    screen.blit(start_text, (800 // 2 - start_text.get_width() // 2, 300))  
    pygame.display.flip()

def show_gameover(): #game over skärm
    screen.fill(black)
    gameover_text = font.render("Game Over!", True, red)
    restart_text = small_font.render("Press enter to try again", True, white)
    screen.blit(gameover_text, (800 // 2 - gameover_text.get_width() // 2, 250))
    screen.blit(restart_text, (800 // 2 - restart_text.get_width() // 2, 350))
    pygame.display.flip()

def environment(level):#level system
    title_text = font.render(f"Level {level}", True, white)
    screen.blit(title_text, (10, 30))


def lives(hearts):   #Life counter and damage calculater
        life_text = small_font.render(f"Lives {hearts}", True, white)
        screen.blit(life_text, (700,30))

# Huvudloop
while True:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            pygame.quit()
            sys.exit()
        elif startmenu and event.type == pygame.KEYDOWN and event.key == pygame.K_RETURN: #startmeny spelet startar vid enter
            startmenu = False
        elif gameover and event.type == pygame.KEYDOWN and event.key == pygame.K_RETURN: #gameover spelet startar om vid enter
            if event.key == pygame.K_RETURN: #reset spelet
                circle_x, circle_y = 40, 300
                fiende_x, fiende_y = 400, 530
                fiende_speed_x = 5
                level = 1
                hearts = 3
                gameover = False
            elif event.key == pygame.K_RETURN:
                pygame.quit()
                sys.exit()

    if startmenu:
        show_start_menu()
        continue
    elif gameover:
        show_gameover()
        continue  # 

    # Tangenttryckningar
    keys = pygame.key.get_pressed()

    #x-led rörelse
    if keys[pygame.K_LEFT]:
        circle_x -= circle_speed_x
    if keys[pygame.K_RIGHT]:
        circle_x += circle_speed_x

    # Hopp och dubbelhopp
    if keys[pygame.K_UP] and on_ground:
        circle_speed_y = jump_strength
        on_ground = False
        doublejump = True
    elif keys[pygame.K_UP] and doublejump and circle_y < 500:
        circle_speed_y = jump_strength
        doublejump = False
        
    # snabbt ner
    if keys[pygame.K_DOWN] and on_ground == False:
            gravity *= 1.5
            damage = 1
    

    # Gravitation och vertikal rörelse
    circle_speed_y += gravity
    circle_y += circle_speed_y

    # Begränsar cirklerns rörelse
    circle_x = max(circle_radius, min(800 - circle_radius, circle_x))
    if circle_y >= 600 - circle_radius:
        circle_y = 600 - circle_radius
        circle_speed_y = 0
        on_ground = True
        gravity = 0.5
        doublejump = False

    # Uppdatera level 
    if circle_x == 760 and circle_y == 560:
        circle_x = 40
        circle_y = 560
        level += 1

    # Fiende rörelse i x led
    fiende_x += fiende_speed_x
    if fiende_x >= 750 or fiende_x <= 0:
        fiende_speed_x *= -1.2

    # Kontrollera kollision med fienden
    fiende_kollision = (circle_x + 30 >= fiende_x and circle_x - 30 <= fiende_x + fiende_storlek and circle_y+circle_radius >= 560 )
    if fiende_kollision:       
        fiende_speed_x *= -1
        if not tagen_skada:
            hearts -= 1
            tagen_skada = True
            if hearts == 0:
                gameover = True     

    #Kollision och damage av spiken
    spik_kollision = (circle_x + 30 >= spik_x and circle_x -30 <= spik_x + spik_x_storlek and circle_y <= spik_y + 20)
    if spik_kollision and not fiende_kollision:    
        if not tagen_skada: 
            hearts-=1    
            tagen_skada = True 
            if hearts == 0:
                gameover = True

    if not (fiende_kollision or spik_kollision):
        tagen_skada = False 
        

    #Uppdatera skärmen
    screen.blit(background_image, (0, 0))
    #Rita spikar
    pygame.draw.polygon(screen, (silver),((430,0),(370,0),(400,160)))

    if gravity == 0.5:
        pygame.draw.circle(screen, black, (int(circle_x), int(circle_y)), circle_radius)
    else: #extra efffekter om man gör attack ner
        pygame.draw.line(screen,black, (int(circle_x),int(circle_y)), (int(circle_x),int(circle_y-100)) ,8)
        pygame.draw.line(screen,black, (int(circle_x-20),int(circle_y)), (int(circle_x-30),int(circle_y-100)) ,8)
        pygame.draw.line(screen,black, (int(circle_x+20),int(circle_y)), (int(circle_x+30),int(circle_y-100)) ,8)
        pygame.draw.circle(screen, red, (int(circle_x), int(circle_y)), circle_radius)
    #fiende 
    pygame.draw.rect(screen, red, (fiende_x, fiende_y, fiende_storlek, fiende_storlek))
    #level
    environment(level)
    #Life counter
    lives(hearts)   


    #Skapar ett hinder och ger den en hitbox
    obstacle1 = pygame.Rect(200, 480, 100, 15) #en rektangel från (200, 480) med bredd 100 och höjd 20
    pygame.draw.rect(screen, red, obstacle1)
    screen.blit(brick_wall, (obstacle1.x, obstacle1.y))

    #Ger en hitbox till "spelaren"
    circle_rect = pygame.Rect(circle_x - circle_radius, circle_y - circle_radius, circle_radius * 2, circle_radius * 2)
        
        
    collide = circle_rect.colliderect(obstacle1)
       
    if collide:
          if circle_y + circle_radius <= obstacle1.top +11 :  # Om cirkeln är ovanför hinderet
            on_ground = True
            circle_speed_y = 0  # Stopp för vertikal rörelse när cirkeln är på hinderet
            circle_y = obstacle1.top - circle_radius  # Justera position så att cirkeln står exakt på toppen av hinderet
                
          else:
        # Om karaktären träffar sidan eller undersidan av hinderet, faller den igen
            on_ground = False
            circle_speed_y = max(circle_speed_y, 5) 



    pygame.display.flip()
    pygame.time.delay(30)
